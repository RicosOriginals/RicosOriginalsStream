
<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wer schaut gerade? — Ricos Originals</title>
<style>
:root{--bg:#0f0f0f;--muted:#b3b3b3;--accent:#e50914;}
html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:Inter,Arial,Helvetica,sans-serif}
.page{max-width:1100px;margin:48px auto;padding:0 16px;text-align:center}
h1{font-size:36px;margin:0 0 8px}
.subtitle{color:var(--muted);margin-bottom:28px}
.profiles{display:flex;gap:20px;justify-content:center;flex-wrap:wrap}
.profile{width:140px;cursor:pointer;user-select:none}
.avatar{width:140px;height:140px;border-radius:8px;overflow:hidden;background:#222;display:block;border:2px solid transparent}
.avatar img{width:100%;height:100%;object-fit:cover;display:block}
.pname{margin-top:10px;font-size:15px}
.add-card{display:flex;align-items:center;justify-content:center;font-size:56px;border:2px dashed rgba(255,255,255,0.12);height:140px;border-radius:8px}
.controls{margin-top:28px}
.btn{display:inline-block;padding:10px 16px;border-radius:6px;background:var(--accent);color:#fff;border:none;font-weight:700;cursor:pointer}
.btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:9999}
.modal{background:#111;padding:18px;border-radius:8px;width:360px;max-width:92%}
.field{margin:8px 0;display:flex;flex-direction:column;align-items:flex-start}
label{font-size:13px;color:var(--muted);margin-bottom:6px}
input[type="text"], input[type="url"]{width:100%;padding:8px;border-radius:6px;border:1px solid #222;background:#0b0b0b;color:#fff}
.avatar-choices{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
.choice{width:64px;height:64px;border-radius:6px;overflow:hidden;cursor:pointer;border:2px solid transparent}
.choice img{width:100%;height:100%;object-fit:cover;display:block}
.choice.selected{outline:3px solid #fff;transform:translateY(-4px)}
.small{color:var(--muted);font-size:13px;margin-top:8px}
.footer{margin-top:36px;color:var(--muted);font-size:13px}
@media (max-width:520px){.profile{width:110px}.avatar{width:110px;height:110px}.add-card{height:110px;font-size:40px}}
</style>
</head>
<body>
<div class="page" role="main">
  <h1>Wer schaut gerade?</h1>
  <p class="subtitle">Wähle dein Profil oder erstelle ein neues (max. 5).</p>

  <div id="profiles" class="profiles" aria-live="polite"></div>

  <div class="controls">
    <button id="openCreate" class="btn">Profil hinzufügen / bearbeiten</button>
    <button id="resetAll" class="btn secondary">Alle Profile entfernen</button>
  </div>

  <div class="footer">Lokale Demo — Profile werden im Browser gespeichert.</div>
</div>

<!-- Modal -->
<div id="modal" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <h2 id="modalTitle">Profil bearbeiten / erstellen</h2>

    <div class="field">
      <label for="pname">Name</label>
      <input id="pname" type="text" maxlength="24" placeholder="Name eingeben (z. B. Du)">
    </div>

    <div class="field">
      <label>Avatar wählen (oder unten Imgur-Link einfügen)</label>
      <div id="avatarChoices" class="avatar-choices" aria-label="Avatar Auswahl"></div>
    </div>

    <div class="field">
      <label for="avatarUrl">Eigene Bild-URL (Imgur etc.)</label>
      <input id="avatarUrl" type="url" placeholder="https://i.imgur.com/...">
    </div>

    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
      <button id="cancel" class="btn secondary">Abbrechen</button>
      <button id="save" class="btn">Speichern</button>
    </div>

    <p class="small">Maximal 5 Profile. Profile werden lokal gespeichert und sind nur in diesem Browser verfügbar.</p>
  </div>
</div>

<script>
// Placeholder avatars (you will replace with your Imgur links later)
const PLACEHOLDER_AVATARS = [
  "https://i.imgur.com/8b1dQxL.jpeg",
  "https://i.imgur.com/3QZ4E1N.jpeg",
  "https://i.imgur.com/u5JtY0p.jpeg",
  "https://i.imgur.com/VKzQyYS.jpeg",
  "https://i.imgur.com/5rF7bE2.jpeg"
];

const MAX_PROFILES = 5;
const STORAGE_KEY = "ricos_profiles_v2";

const profilesEl = document.getElementById("profiles");
const openCreate = document.getElementById("openCreate");
const resetAll = document.getElementById("resetAll");
const modal = document.getElementById("modal");
const avatarChoices = document.getElementById("avatarChoices");
const pname = document.getElementById("pname");
const avatarUrl = document.getElementById("avatarUrl");
const cancel = document.getElementById("cancel");
const saveBtn = document.getElementById("save");

let profiles = [];
let editIndex = -1;
let selectedAvatar = PLACEHOLDER_AVATARS[0];

function load() {
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    profiles = raw ? JSON.parse(raw) : null;
  } catch(e){ profiles = null; }
  if(!profiles || !Array.isArray(profiles) || profiles.length === 0){
    // create initial single profile "Du"
    profiles = [{ name: "Du", avatar: PLACEHOLDER_AVATARS[0] }];
    save();
  }
}
function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(profiles));
}

function render(){
  profilesEl.innerHTML = "";
  profiles.forEach((p, idx) => {
    const div = document.createElement("div");
    div.className = "profile";
    div.innerHTML = `<div class="avatar" data-idx="${idx}"><img src="${p.avatar}" alt="${p.name}"></div><div class="pname">${escapeHtml(p.name)}</div>`;
    div.addEventListener("click", ()=> {
      // select profile -> go to player (streaming.html expected)
      localStorage.setItem("ricos_selected_profile", idx);
      window.location.href = "streaming.html";
    });
    // right-click to edit
    div.addEventListener("contextmenu", (e)=>{ e.preventDefault(); openModal(idx); });
    profilesEl.appendChild(div);
  });

  if(profiles.length < MAX_PROFILES){
    const add = document.createElement("div");
    add.className = "profile";
    add.innerHTML = `<div class="add-card">+</div><div class="pname">Profil hinzufügen</div>`;
    add.addEventListener("click", ()=> openModal(profiles.length));
    profilesEl.appendChild(add);
  }
}

function openModal(index){
  editIndex = (typeof index === "number") ? index : -1;
  selectedAvatar = PLACEHOLDER_AVATARS[0];
  // populate avatar choices
  avatarChoices.innerHTML = "";
  PLACEHOLDER_AVATARS.forEach((u)=> {
    const c = document.createElement("div");
    c.className = "choice";
    c.innerHTML = `<img src="${u}" alt="avatar">`;
    c.addEventListener("click", ()=> {
      selectedAvatar = u;
      document.querySelectorAll(".choice").forEach(x=>x.classList.remove("selected"));
      c.classList.add("selected");
      avatarUrl.value = "";
    });
    avatarChoices.appendChild(c);
  });

  if(index >=0 && index < profiles.length){
    // editing existing
    pname.value = profiles[index].name;
    selectedAvatar = profiles[index].avatar || PLACEHOLDER_AVATARS[0];
    // mark selected
    Array.from(avatarChoices.children).forEach(ch=>{
      if(ch.querySelector("img").src === selectedAvatar) ch.classList.add("selected");
    });
  } else {
    // new profile
    pname.value = "";
    avatarUrl.value = "";
  }

  modal.style.display = "flex";
  modal.setAttribute("aria-hidden","false");
  setTimeout(()=> pname.focus(),50);
}

function closeModal(){
  modal.style.display = "none";
  modal.setAttribute("aria-hidden","true");
  editIndex = -1;
}

cancel.addEventListener("click", closeModal);

saveBtn.addEventListener("click", ()=>{
  const name = pname.value.trim() || "Gast";
  const url = avatarUrl.value.trim();
  const avatar = url || selectedAvatar || PLACEHOLDER_AVATARS[0];

  if(editIndex >=0 && editIndex < profiles.length){
    // update
    profiles[editIndex].name = name;
    profiles[editIndex].avatar = avatar;
  } else {
    // create new if room
    if(profiles.length >= MAX_PROFILES){
      alert("Maximal 5 Profile erlaubt.");
      return;
    }
    profiles.push({ name, avatar });
  }
  save();
  render();
  closeModal();
});

resetAll.addEventListener("click", ()=>{
  if(confirm("Alle Profile löschen? (Die Seite legt danach wieder ein Standard-Profil 'Du' an)")){
    localStorage.removeItem(STORAGE_KEY);
    load();
    render();
  }
});

openCreate.addEventListener("click", ()=> openModal(profiles.length < MAX_PROFILES ? profiles.length : 0));

// allow editing by long-press or keyboard - also add delete via double-click
profilesEl.addEventListener("dblclick", (e)=> {
  // find nearest profile
  const p = e.target.closest(".profile");
  if(!p) return;
  const idx = Array.from(profilesEl.children).indexOf(p);
  if(idx >=0 && idx < profiles.length){
    if(confirm("Profil löschen?")) {
      profiles.splice(idx,1);
      save();
      render();
    }
  }
});

function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m])); }

// init
load();
render();

// close modal on backdrop click
modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

</script>
</body>
</html>
